{"ast":null,"code":"import SequentialIDGenerator from \"./sequential-id-generator\";\nimport sortMq from \"./sort-css-media-queries\";\nexport class MultiCache {\n  constructor(idGenerator, onNewCache, onNewValue) {\n    this.idGenerator = idGenerator;\n    this.onNewCache = onNewCache;\n    this.onNewValue = onNewValue;\n    this.sortedCacheKeys = [];\n    this.caches = {};\n  }\n  getCache(key) {\n    if (!this.caches[key]) {\n      const cache = new Cache(this.idGenerator, this.onNewValue);\n      cache.key = key;\n      this.sortedCacheKeys.push(key);\n      this.sortedCacheKeys.sort(sortMq);\n      const keyIndex = this.sortedCacheKeys.indexOf(key);\n      const insertBeforeMedia = keyIndex < this.sortedCacheKeys.length - 1 ? this.sortedCacheKeys[keyIndex + 1] : void 0;\n      this.caches[key] = cache;\n      this.onNewCache(key, cache, insertBeforeMedia);\n    }\n    return this.caches[key];\n  }\n  getSortedCacheKeys() {\n    return this.sortedCacheKeys;\n  }\n}\nexport class Cache {\n  constructor(idGenerator, onNewValue) {\n    this.cache = {};\n    this.idGenerator = idGenerator;\n    this.onNewValue = onNewValue;\n  }\n  addValue(key, value) {\n    const cached = this.cache[key];\n    if (cached) {\n      return cached;\n    }\n    const id = this.idGenerator.next();\n    this.cache[key] = id;\n    this.onNewValue(this, id, value);\n    return id;\n  }\n}","map":{"version":3,"names":["SequentialIDGenerator","sortMq","MultiCache","constructor","idGenerator","onNewCache","onNewValue","sortedCacheKeys","caches","getCache","key","cache","Cache","push","sort","keyIndex","indexOf","insertBeforeMedia","length","getSortedCacheKeys","addValue","value","cached","id","next"],"sources":["src/cache.ts"],"sourcesContent":["import SequentialIDGenerator from \"./sequential-id-generator\";\nimport sortMq from \"./sort-css-media-queries\";\n\ntype OnNewCacheFn<T> = (\n  key: string,\n  cache: Cache<T>,\n  value?: string | null,\n) => any;\ntype OnNewValueFn<T> = (cache: Cache<T>, id: string, value: T) => any;\n\nexport class MultiCache<T> {\n  caches: {\n    [x: string]: Cache<T>;\n  };\n  idGenerator: SequentialIDGenerator;\n  onNewCache: OnNewCacheFn<T>;\n  onNewValue: OnNewValueFn<T>;\n  sortedCacheKeys: string[];\n\n  constructor(\n    idGenerator: SequentialIDGenerator,\n    onNewCache: OnNewCacheFn<T>,\n    onNewValue: OnNewValueFn<T>,\n  ) {\n    this.idGenerator = idGenerator;\n    this.onNewCache = onNewCache;\n    this.onNewValue = onNewValue;\n    this.sortedCacheKeys = [];\n    this.caches = {};\n  }\n\n  getCache(key: string): Cache<T> {\n    if (!this.caches[key]) {\n      const cache = new Cache(this.idGenerator, this.onNewValue);\n      cache.key = key;\n      this.sortedCacheKeys.push(key);\n      this.sortedCacheKeys.sort(sortMq);\n      const keyIndex = this.sortedCacheKeys.indexOf(key);\n      const insertBeforeMedia =\n        keyIndex < this.sortedCacheKeys.length - 1\n          ? this.sortedCacheKeys[keyIndex + 1]\n          : void 0;\n      this.caches[key] = cache;\n      this.onNewCache(key, cache, insertBeforeMedia);\n    }\n    return this.caches[key];\n  }\n\n  getSortedCacheKeys() {\n    return this.sortedCacheKeys;\n  }\n}\n\nexport class Cache<T> {\n  cache: {\n    [x: string]: string;\n  };\n  idGenerator: SequentialIDGenerator;\n  key: string;\n  onNewValue: (cache: Cache<T>, id: string, value: any) => any;\n\n  constructor(\n    idGenerator: SequentialIDGenerator,\n    onNewValue: (cache: Cache<T>, id: string, value: any) => any,\n  ) {\n    this.cache = {};\n    this.idGenerator = idGenerator;\n    this.onNewValue = onNewValue;\n  }\n\n  addValue(key: string, value: T) {\n    const cached = this.cache[key];\n    if (cached) {\n      return cached;\n    }\n    const id = this.idGenerator.next();\n    this.cache[key] = id;\n    this.onNewValue(this, id, value);\n    return id;\n  }\n}\n"],"mappings":"AAAA,OAAOA,qBAAP,MAAkC,2BAAlC;AACA,OAAOC,MAAP,MAAmB,0BAAnB;AASA,OAAO,MAAMC,UAAN,CAAoB;EASzBC,WAAWA,CACTC,WADS,EAETC,UAFS,EAGTC,UAHS,EAIT;IACA,KAAKF,WAAL,GAAmBA,WAAnB;IACA,KAAKC,UAAL,GAAkBA,UAAlB;IACA,KAAKC,UAAL,GAAkBA,UAAlB;IACA,KAAKC,eAAL,GAAuB,EAAvB;IACA,KAAKC,MAAL,GAAc,EAAd;EACD;EAEDC,QAAQA,CAACC,GAAD,EAAwB;IAC9B,IAAI,CAAC,KAAKF,MAAL,CAAYE,GAAZ,CAAL,EAAuB;MACrB,MAAMC,KAAK,GAAG,IAAIC,KAAJ,CAAU,KAAKR,WAAf,EAA4B,KAAKE,UAAjC,CAAd;MACAK,KAAK,CAACD,GAAN,GAAYA,GAAZ;MACA,KAAKH,eAAL,CAAqBM,IAArB,CAA0BH,GAA1B;MACA,KAAKH,eAAL,CAAqBO,IAArB,CAA0Bb,MAA1B;MACA,MAAMc,QAAQ,GAAG,KAAKR,eAAL,CAAqBS,OAArB,CAA6BN,GAA7B,CAAjB;MACA,MAAMO,iBAAiB,GACrBF,QAAQ,GAAG,KAAKR,eAAL,CAAqBW,MAArB,GAA8B,CAAzC,GACI,KAAKX,eAAL,CAAqBQ,QAAQ,GAAG,CAAhC,CADJ,GAEI,KAAK,CAHX;MAIA,KAAKP,MAAL,CAAYE,GAAZ,IAAmBC,KAAnB;MACA,KAAKN,UAAL,CAAgBK,GAAhB,EAAqBC,KAArB,EAA4BM,iBAA5B;IACD;IACD,OAAO,KAAKT,MAAL,CAAYE,GAAZ,CAAP;EACD;EAEDS,kBAAkBA,CAAA,EAAG;IACnB,OAAO,KAAKZ,eAAZ;EACD;AAxCwB;AA2C3B,OAAO,MAAMK,KAAN,CAAe;EAQpBT,WAAWA,CACTC,WADS,EAETE,UAFS,EAGT;IACA,KAAKK,KAAL,GAAa,EAAb;IACA,KAAKP,WAAL,GAAmBA,WAAnB;IACA,KAAKE,UAAL,GAAkBA,UAAlB;EACD;EAEDc,QAAQA,CAACV,GAAD,EAAcW,KAAd,EAAwB;IAC9B,MAAMC,MAAM,GAAG,KAAKX,KAAL,CAAWD,GAAX,CAAf;IACA,IAAIY,MAAJ,EAAY;MACV,OAAOA,MAAP;IACD;IACD,MAAMC,EAAE,GAAG,KAAKnB,WAAL,CAAiBoB,IAAjB,EAAX;IACA,KAAKb,KAAL,CAAWD,GAAX,IAAkBa,EAAlB;IACA,KAAKjB,UAAL,CAAgB,IAAhB,EAAsBiB,EAAtB,EAA0BF,KAA1B;IACA,OAAOE,EAAP;EACD;AA1BmB"},"metadata":{},"sourceType":"module"}