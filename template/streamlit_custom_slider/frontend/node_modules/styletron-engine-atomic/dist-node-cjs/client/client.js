"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _sequentialIdGenerator = _interopRequireDefault(require("../sequential-id-generator"));

var _cache2 = require("../cache");

var _injectStylePrefixed = _interopRequireDefault(require("../inject-style-prefixed"));

var _css = require("../css");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/* eslint-env browser */
const STYLES_HYDRATOR = /\.([^{:]+)(:[^{]+)?{(?:[^}]*;)?([^}]*?)}/g;
const KEYFRAMES_HYRDATOR = /@keyframes ([^{]+){((?:(?:from|to|(?:\d+\.?\d*%))\{(?:[^}])*})*)}/g;
const FONT_FACE_HYDRATOR = /@font-face\{font-family:([^;]+);([^}]*)\}/g;

function hydrateStyles(cache, hydrator, css) {
  let match;

  while (match = hydrator.exec(css)) {
    const [, id, pseudo, key] = match;

    if (false && process.env.NODE_ENV !== "production" && window.__STYLETRON_DEVTOOLS__) {
      hydrateDevtoolsRule(match[0]);
    }

    const fullKey = pseudo ? `${pseudo}${key}` : key;
    cache.cache[fullKey] = id; // set cache without triggering side effects

    cache.idGenerator.increment(); // increment id
  }
}

function hydrate(cache, hydrator, css) {
  let match;

  while (match = hydrator.exec(css)) {
    const [, id, key] = match;

    if (false && process.env.NODE_ENV !== "production" && window.__STYLETRON_DEVTOOLS__) {
      hydrateDevtoolsRule(match[0]);
    }

    cache.cache[key] = id; // set cache without triggering side effects

    cache.idGenerator.increment(); // increment id
  }
}

class StyletronClient {
  constructor(opts = {}) {
    this.styleElements = {};
    const styleIdGenerator = new _sequentialIdGenerator.default(opts.prefix);

    const onNewStyle = (cache, id, value) => {
      const {
        pseudo,
        block
      } = value;
      const sheet = this.styleElements[cache.key].sheet;
      const selector = (0, _css.atomicSelector)(id, pseudo);
      const rule = (0, _css.styleBlockToRule)(selector, block);

      try {
        sheet.insertRule(rule, sheet.cssRules.length);

        if (false && process.env.NODE_ENV !== "production" && window.__STYLETRON_DEVTOOLS__) {
          insertRuleIntoDevtools(selector, block);
        }
      } catch (e) {
        if (process.env.NODE_ENV !== "production") {
          // eslint-disable-next-line no-console
          console.warn(`Failed to inject CSS: "${rule}". Perhaps this has invalid or un-prefixed properties?`);
        }
      }
    }; // Setup style cache


    this.styleCache = new _cache2.MultiCache(styleIdGenerator, (media, _cache, insertBeforeMedia) => {
      const styleElement = document.createElement("style");
      styleElement.media = media;

      if (insertBeforeMedia === void 0) {
        this.container.appendChild(styleElement);
      } else {
        const insertBeforeIndex = findSheetIndexWithMedia(this.container.children, insertBeforeMedia);
        this.container.insertBefore(styleElement, this.container.children[insertBeforeIndex]);
      }

      this.styleElements[media] = styleElement;
    }, onNewStyle);
    this.keyframesCache = new _cache2.Cache(new _sequentialIdGenerator.default(opts.prefix), (cache, id, value) => {
      this.styleCache.getCache("");
      const sheet = this.styleElements[""].sheet;
      const rule = (0, _css.keyframesBlockToRule)(id, (0, _css.keyframesToBlock)(value));

      try {
        sheet.insertRule(rule, sheet.cssRules.length);
      } catch (e) {
        if (process.env.NODE_ENV !== "production") {
          // eslint-disable-next-line no-console
          console.warn(`Failed to inject CSS: "${rule}". Perhaps this has invalid or un-prefixed properties?`);
        }
      }
    });
    this.fontFaceCache = new _cache2.Cache(new _sequentialIdGenerator.default(opts.prefix), (cache, id, value) => {
      this.styleCache.getCache("");
      const sheet = this.styleElements[""].sheet;
      const rule = (0, _css.fontFaceBlockToRule)(id, (0, _css.declarationsToBlock)(value));

      try {
        sheet.insertRule(rule, sheet.cssRules.length);
      } catch (e) {
        if (process.env.NODE_ENV !== "production") {
          // eslint-disable-next-line no-console
          console.warn(`Failed to inject CSS: "${rule}". Perhaps this has invalid or un-prefixed properties?`);
        }
      }
    });

    if (opts.container) {
      this.container = opts.container;
    } // Hydrate


    if (opts.hydrate && opts.hydrate.length > 0) {
      // infer container from parent element
      if (!this.container) {
        const parentElement = opts.hydrate[0].parentElement;

        if (parentElement !== null && parentElement !== void 0) {
          this.container = parentElement;
        }
      }

      for (let i = 0; i < opts.hydrate.length; i++) {
        const element = opts.hydrate[i];
        const hydrateType = element.getAttribute("data-hydrate");

        if (hydrateType === "font-face") {
          hydrate(this.fontFaceCache, FONT_FACE_HYDRATOR, element.textContent);
          continue;
        }

        if (hydrateType === "keyframes") {
          hydrate(this.keyframesCache, KEYFRAMES_HYRDATOR, element.textContent);
          continue;
        }

        const key = element.media ? element.media : "";
        this.styleElements[key] = element;
        const cache = new _cache2.Cache(styleIdGenerator, onNewStyle);
        cache.key = key;
        hydrateStyles(cache, STYLES_HYDRATOR, element.textContent);
        this.styleCache.sortedCacheKeys.push(key);
        this.styleCache.caches[key] = cache;
      }
    }

    if (!this.container) {
      if (document.head === null) {
        throw new Error("No container provided and `document.head` was null");
      }

      this.container = document.head;
    }
  }

  renderStyle(style) {
    return (0, _injectStylePrefixed.default)(this.styleCache, style, "", "");
  }

  renderFontFace(fontFace) {
    const key = (0, _css.declarationsToBlock)(fontFace);
    return this.fontFaceCache.addValue(key, fontFace);
  }

  renderKeyframes(keyframes) {
    const key = (0, _css.keyframesToBlock)(keyframes);
    return this.keyframesCache.addValue(key, keyframes);
  }

}

var _default = StyletronClient;
exports.default = _default;

function findSheetIndexWithMedia(children, media) {
  let index = 0;

  for (; index < children.length; index++) {
    const child = children[index];

    if (child.tagName === "STYLE" && child.media === media) {
      return index;
    }
  }

  return -1;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTVFlMRVNfSFlEUkFUT1IiLCJLRVlGUkFNRVNfSFlSREFUT1IiLCJGT05UX0ZBQ0VfSFlEUkFUT1IiLCJoeWRyYXRlU3R5bGVzIiwiY2FjaGUiLCJoeWRyYXRvciIsImNzcyIsIm1hdGNoIiwiZXhlYyIsImlkIiwicHNldWRvIiwia2V5Iiwid2luZG93IiwiX19TVFlMRVRST05fREVWVE9PTFNfXyIsImh5ZHJhdGVEZXZ0b29sc1J1bGUiLCJmdWxsS2V5IiwiaWRHZW5lcmF0b3IiLCJpbmNyZW1lbnQiLCJoeWRyYXRlIiwiU3R5bGV0cm9uQ2xpZW50IiwiY29uc3RydWN0b3IiLCJvcHRzIiwic3R5bGVFbGVtZW50cyIsInN0eWxlSWRHZW5lcmF0b3IiLCJTZXF1ZW50aWFsSURHZW5lcmF0b3IiLCJwcmVmaXgiLCJvbk5ld1N0eWxlIiwidmFsdWUiLCJibG9jayIsInNoZWV0Iiwic2VsZWN0b3IiLCJhdG9taWNTZWxlY3RvciIsInJ1bGUiLCJzdHlsZUJsb2NrVG9SdWxlIiwiaW5zZXJ0UnVsZSIsImNzc1J1bGVzIiwibGVuZ3RoIiwiaW5zZXJ0UnVsZUludG9EZXZ0b29scyIsImUiLCJjb25zb2xlIiwid2FybiIsInN0eWxlQ2FjaGUiLCJNdWx0aUNhY2hlIiwibWVkaWEiLCJfY2FjaGUiLCJpbnNlcnRCZWZvcmVNZWRpYSIsInN0eWxlRWxlbWVudCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImNvbnRhaW5lciIsImFwcGVuZENoaWxkIiwiaW5zZXJ0QmVmb3JlSW5kZXgiLCJmaW5kU2hlZXRJbmRleFdpdGhNZWRpYSIsImNoaWxkcmVuIiwiaW5zZXJ0QmVmb3JlIiwia2V5ZnJhbWVzQ2FjaGUiLCJDYWNoZSIsImdldENhY2hlIiwia2V5ZnJhbWVzQmxvY2tUb1J1bGUiLCJrZXlmcmFtZXNUb0Jsb2NrIiwiZm9udEZhY2VDYWNoZSIsImZvbnRGYWNlQmxvY2tUb1J1bGUiLCJkZWNsYXJhdGlvbnNUb0Jsb2NrIiwicGFyZW50RWxlbWVudCIsImkiLCJlbGVtZW50IiwiaHlkcmF0ZVR5cGUiLCJnZXRBdHRyaWJ1dGUiLCJ0ZXh0Q29udGVudCIsInNvcnRlZENhY2hlS2V5cyIsInB1c2giLCJjYWNoZXMiLCJoZWFkIiwiRXJyb3IiLCJyZW5kZXJTdHlsZSIsInN0eWxlIiwiaW5qZWN0U3R5bGVQcmVmaXhlZCIsInJlbmRlckZvbnRGYWNlIiwiZm9udEZhY2UiLCJhZGRWYWx1ZSIsInJlbmRlcktleWZyYW1lcyIsImtleWZyYW1lcyIsImluZGV4IiwiY2hpbGQiLCJ0YWdOYW1lIl0sInNvdXJjZXMiOlsic3JjL2NsaWVudC9jbGllbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWVudiBicm93c2VyICovXG5cbmRlY2xhcmUgdmFyIF9fREVWX186IGJvb2xlYW47XG5cbmRlY2xhcmUgdmFyIF9fQlJPV1NFUl9fOiBib29sZWFuO1xuXG5jb25zdCBTVFlMRVNfSFlEUkFUT1IgPSAvXFwuKFteezpdKykoOltee10rKT97KD86W159XSo7KT8oW159XSo/KX0vZztcbmNvbnN0IEtFWUZSQU1FU19IWVJEQVRPUiA9XG4gIC9Aa2V5ZnJhbWVzIChbXntdKyl7KCg/Oig/OmZyb218dG98KD86XFxkK1xcLj9cXGQqJSkpXFx7KD86W159XSkqfSkqKX0vZztcbmNvbnN0IEZPTlRfRkFDRV9IWURSQVRPUiA9IC9AZm9udC1mYWNlXFx7Zm9udC1mYW1pbHk6KFteO10rKTsoW159XSopXFx9L2c7XG5cbnR5cGUgaHlkcmF0b3JUID1cbiAgfCB0eXBlb2YgU1RZTEVTX0hZRFJBVE9SXG4gIHwgdHlwZW9mIEtFWUZSQU1FU19IWVJEQVRPUlxuICB8IHR5cGVvZiBGT05UX0ZBQ0VfSFlEUkFUT1I7XG5cbmZ1bmN0aW9uIGh5ZHJhdGVTdHlsZXM8VD4oY2FjaGU6IENhY2hlPFQ+LCBoeWRyYXRvcjogaHlkcmF0b3JULCBjc3M6IHN0cmluZykge1xuICBsZXQgbWF0Y2g7XG4gIHdoaWxlICgobWF0Y2ggPSBoeWRyYXRvci5leGVjKGNzcykpKSB7XG4gICAgY29uc3QgWywgaWQsIHBzZXVkbywga2V5XSA9IG1hdGNoO1xuICAgIGlmIChfX0JST1dTRVJfXyAmJiBfX0RFVl9fICYmIHdpbmRvdy5fX1NUWUxFVFJPTl9ERVZUT09MU19fKSB7XG4gICAgICBoeWRyYXRlRGV2dG9vbHNSdWxlKG1hdGNoWzBdKTtcbiAgICB9XG4gICAgY29uc3QgZnVsbEtleSA9IHBzZXVkbyA/IGAke3BzZXVkb30ke2tleX1gIDoga2V5O1xuICAgIGNhY2hlLmNhY2hlW2Z1bGxLZXldID0gaWQ7IC8vIHNldCBjYWNoZSB3aXRob3V0IHRyaWdnZXJpbmcgc2lkZSBlZmZlY3RzXG4gICAgY2FjaGUuaWRHZW5lcmF0b3IuaW5jcmVtZW50KCk7IC8vIGluY3JlbWVudCBpZFxuICB9XG59XG5cbmZ1bmN0aW9uIGh5ZHJhdGU8VD4oY2FjaGU6IENhY2hlPFQ+LCBoeWRyYXRvcjogaHlkcmF0b3JULCBjc3M6IHN0cmluZykge1xuICBsZXQgbWF0Y2g7XG4gIHdoaWxlICgobWF0Y2ggPSBoeWRyYXRvci5leGVjKGNzcykpKSB7XG4gICAgY29uc3QgWywgaWQsIGtleV0gPSBtYXRjaDtcbiAgICBpZiAoX19CUk9XU0VSX18gJiYgX19ERVZfXyAmJiB3aW5kb3cuX19TVFlMRVRST05fREVWVE9PTFNfXykge1xuICAgICAgaHlkcmF0ZURldnRvb2xzUnVsZShtYXRjaFswXSk7XG4gICAgfVxuICAgIGNhY2hlLmNhY2hlW2tleV0gPSBpZDsgLy8gc2V0IGNhY2hlIHdpdGhvdXQgdHJpZ2dlcmluZyBzaWRlIGVmZmVjdHNcbiAgICBjYWNoZS5pZEdlbmVyYXRvci5pbmNyZW1lbnQoKTsgLy8gaW5jcmVtZW50IGlkXG4gIH1cbn1cblxuaW1wb3J0IFNlcXVlbnRpYWxJREdlbmVyYXRvciBmcm9tIFwiLi4vc2VxdWVudGlhbC1pZC1nZW5lcmF0b3JcIjtcblxuaW1wb3J0IHR5cGUge1xuICBTdGFuZGFyZEVuZ2luZSxcbiAgS2V5ZnJhbWVzT2JqZWN0LFxuICBGb250RmFjZU9iamVjdCxcbiAgU3R5bGVPYmplY3QsXG59IGZyb20gXCJzdHlsZXRyb24tc3RhbmRhcmRcIjtcblxuaW1wb3J0IHtDYWNoZSwgTXVsdGlDYWNoZX0gZnJvbSBcIi4uL2NhY2hlXCI7XG5cbmltcG9ydCBpbmplY3RTdHlsZVByZWZpeGVkIGZyb20gXCIuLi9pbmplY3Qtc3R5bGUtcHJlZml4ZWRcIjtcblxuaW1wb3J0IHtcbiAgc3R5bGVCbG9ja1RvUnVsZSxcbiAgYXRvbWljU2VsZWN0b3IsXG4gIGtleWZyYW1lc0Jsb2NrVG9SdWxlLFxuICBkZWNsYXJhdGlvbnNUb0Jsb2NrLFxuICBrZXlmcmFtZXNUb0Jsb2NrLFxuICBmb250RmFjZUJsb2NrVG9SdWxlLFxufSBmcm9tIFwiLi4vY3NzXCI7XG5pbXBvcnQge2luc2VydFJ1bGVJbnRvRGV2dG9vbHMsIGh5ZHJhdGVEZXZ0b29sc1J1bGV9IGZyb20gXCIuLi9kZXYtdG9vbFwiO1xuXG50eXBlIGh5ZHJhdGVUID1cbiAgfCBIVE1MQ29sbGVjdGlvbk9mPEhUTUxTdHlsZUVsZW1lbnQ+XG4gIHwgQXJyYXk8SFRNTFN0eWxlRWxlbWVudD5cbiAgfCBOb2RlTGlzdE9mPEhUTUxTdHlsZUVsZW1lbnQ+O1xuXG50eXBlIG9wdGlvbnNUID0ge1xuICBoeWRyYXRlPzogaHlkcmF0ZVQ7XG4gIGNvbnRhaW5lcj86IEVsZW1lbnQ7XG4gIHByZWZpeD86IHN0cmluZztcbn07XG5cbmNsYXNzIFN0eWxldHJvbkNsaWVudCBpbXBsZW1lbnRzIFN0YW5kYXJkRW5naW5lIHtcbiAgY29udGFpbmVyOiBFbGVtZW50O1xuICBzdHlsZUVsZW1lbnRzOiB7XG4gICAgW3g6IHN0cmluZ106IEhUTUxTdHlsZUVsZW1lbnQ7XG4gIH07XG4gIGZvbnRGYWNlU2hlZXQ6IEhUTUxTdHlsZUVsZW1lbnQ7XG4gIGtleWZyYW1lc1NoZWV0OiBIVE1MU3R5bGVFbGVtZW50O1xuXG4gIHN0eWxlQ2FjaGU6IE11bHRpQ2FjaGU8e1xuICAgIHBzZXVkbzogc3RyaW5nO1xuICAgIGJsb2NrOiBzdHJpbmc7XG4gIH0+O1xuICBrZXlmcmFtZXNDYWNoZTogQ2FjaGU8S2V5ZnJhbWVzT2JqZWN0PjtcbiAgZm9udEZhY2VDYWNoZTogQ2FjaGU8Rm9udEZhY2VPYmplY3Q+O1xuXG4gIGNvbnN0cnVjdG9yKG9wdHM6IG9wdGlvbnNUID0ge30pIHtcbiAgICB0aGlzLnN0eWxlRWxlbWVudHMgPSB7fTtcblxuICAgIGNvbnN0IHN0eWxlSWRHZW5lcmF0b3IgPSBuZXcgU2VxdWVudGlhbElER2VuZXJhdG9yKG9wdHMucHJlZml4KTtcbiAgICBjb25zdCBvbk5ld1N0eWxlID0gKGNhY2hlLCBpZCwgdmFsdWUpID0+IHtcbiAgICAgIGNvbnN0IHtwc2V1ZG8sIGJsb2NrfSA9IHZhbHVlO1xuICAgICAgY29uc3Qgc2hlZXQ6IENTU1N0eWxlU2hlZXQgPSB0aGlzLnN0eWxlRWxlbWVudHNbY2FjaGUua2V5XS5zaGVldCBhcyBhbnk7XG4gICAgICBjb25zdCBzZWxlY3RvciA9IGF0b21pY1NlbGVjdG9yKGlkLCBwc2V1ZG8pO1xuICAgICAgY29uc3QgcnVsZSA9IHN0eWxlQmxvY2tUb1J1bGUoc2VsZWN0b3IsIGJsb2NrKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIHNoZWV0Lmluc2VydFJ1bGUocnVsZSwgc2hlZXQuY3NzUnVsZXMubGVuZ3RoKTtcbiAgICAgICAgaWYgKF9fQlJPV1NFUl9fICYmIF9fREVWX18gJiYgd2luZG93Ll9fU1RZTEVUUk9OX0RFVlRPT0xTX18pIHtcbiAgICAgICAgICBpbnNlcnRSdWxlSW50b0RldnRvb2xzKHNlbGVjdG9yLCBibG9jayk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgaWYgKF9fREVWX18pIHtcbiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuICAgICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAgIGBGYWlsZWQgdG8gaW5qZWN0IENTUzogXCIke3J1bGV9XCIuIFBlcmhhcHMgdGhpcyBoYXMgaW52YWxpZCBvciB1bi1wcmVmaXhlZCBwcm9wZXJ0aWVzP2AsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBTZXR1cCBzdHlsZSBjYWNoZVxuICAgIHRoaXMuc3R5bGVDYWNoZSA9IG5ldyBNdWx0aUNhY2hlKFxuICAgICAgc3R5bGVJZEdlbmVyYXRvcixcbiAgICAgIChtZWRpYSwgX2NhY2hlLCBpbnNlcnRCZWZvcmVNZWRpYSkgPT4ge1xuICAgICAgICBjb25zdCBzdHlsZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3R5bGVcIik7XG4gICAgICAgIHN0eWxlRWxlbWVudC5tZWRpYSA9IG1lZGlhO1xuICAgICAgICBpZiAoaW5zZXJ0QmVmb3JlTWVkaWEgPT09IHZvaWQgMCkge1xuICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHN0eWxlRWxlbWVudCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgaW5zZXJ0QmVmb3JlSW5kZXggPSBmaW5kU2hlZXRJbmRleFdpdGhNZWRpYShcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmNoaWxkcmVuLFxuICAgICAgICAgICAgaW5zZXJ0QmVmb3JlTWVkaWEsXG4gICAgICAgICAgKTtcbiAgICAgICAgICB0aGlzLmNvbnRhaW5lci5pbnNlcnRCZWZvcmUoXG4gICAgICAgICAgICBzdHlsZUVsZW1lbnQsXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5jaGlsZHJlbltpbnNlcnRCZWZvcmVJbmRleF0sXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc3R5bGVFbGVtZW50c1ttZWRpYV0gPSBzdHlsZUVsZW1lbnQ7XG4gICAgICB9LFxuICAgICAgb25OZXdTdHlsZSxcbiAgICApO1xuXG4gICAgdGhpcy5rZXlmcmFtZXNDYWNoZSA9IG5ldyBDYWNoZShcbiAgICAgIG5ldyBTZXF1ZW50aWFsSURHZW5lcmF0b3Iob3B0cy5wcmVmaXgpLFxuICAgICAgKGNhY2hlLCBpZCwgdmFsdWUpID0+IHtcbiAgICAgICAgdGhpcy5zdHlsZUNhY2hlLmdldENhY2hlKFwiXCIpO1xuICAgICAgICBjb25zdCBzaGVldDogQ1NTU3R5bGVTaGVldCA9IHRoaXMuc3R5bGVFbGVtZW50c1tcIlwiXS5zaGVldCBhcyBhbnk7XG4gICAgICAgIGNvbnN0IHJ1bGUgPSBrZXlmcmFtZXNCbG9ja1RvUnVsZShpZCwga2V5ZnJhbWVzVG9CbG9jayh2YWx1ZSkpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHNoZWV0Lmluc2VydFJ1bGUocnVsZSwgc2hlZXQuY3NzUnVsZXMubGVuZ3RoKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuICAgICAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICAgICBgRmFpbGVkIHRvIGluamVjdCBDU1M6IFwiJHtydWxlfVwiLiBQZXJoYXBzIHRoaXMgaGFzIGludmFsaWQgb3IgdW4tcHJlZml4ZWQgcHJvcGVydGllcz9gLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgKTtcblxuICAgIHRoaXMuZm9udEZhY2VDYWNoZSA9IG5ldyBDYWNoZShcbiAgICAgIG5ldyBTZXF1ZW50aWFsSURHZW5lcmF0b3Iob3B0cy5wcmVmaXgpLFxuICAgICAgKGNhY2hlLCBpZCwgdmFsdWUpID0+IHtcbiAgICAgICAgdGhpcy5zdHlsZUNhY2hlLmdldENhY2hlKFwiXCIpO1xuICAgICAgICBjb25zdCBzaGVldDogQ1NTU3R5bGVTaGVldCA9IHRoaXMuc3R5bGVFbGVtZW50c1tcIlwiXS5zaGVldCBhcyBhbnk7XG4gICAgICAgIGNvbnN0IHJ1bGUgPSBmb250RmFjZUJsb2NrVG9SdWxlKGlkLCBkZWNsYXJhdGlvbnNUb0Jsb2NrKHZhbHVlKSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgc2hlZXQuaW5zZXJ0UnVsZShydWxlLCBzaGVldC5jc3NSdWxlcy5sZW5ndGgpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgaWYgKF9fREVWX18pIHtcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICAgIGBGYWlsZWQgdG8gaW5qZWN0IENTUzogXCIke3J1bGV9XCIuIFBlcmhhcHMgdGhpcyBoYXMgaW52YWxpZCBvciB1bi1wcmVmaXhlZCBwcm9wZXJ0aWVzP2AsXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICApO1xuXG4gICAgaWYgKG9wdHMuY29udGFpbmVyKSB7XG4gICAgICB0aGlzLmNvbnRhaW5lciA9IG9wdHMuY29udGFpbmVyO1xuICAgIH1cblxuICAgIC8vIEh5ZHJhdGVcbiAgICBpZiAob3B0cy5oeWRyYXRlICYmIG9wdHMuaHlkcmF0ZS5sZW5ndGggPiAwKSB7XG4gICAgICAvLyBpbmZlciBjb250YWluZXIgZnJvbSBwYXJlbnQgZWxlbWVudFxuICAgICAgaWYgKCF0aGlzLmNvbnRhaW5lcikge1xuICAgICAgICBjb25zdCBwYXJlbnRFbGVtZW50ID0gb3B0cy5oeWRyYXRlWzBdLnBhcmVudEVsZW1lbnQ7XG4gICAgICAgIGlmIChwYXJlbnRFbGVtZW50ICE9PSBudWxsICYmIHBhcmVudEVsZW1lbnQgIT09IHZvaWQgMCkge1xuICAgICAgICAgIHRoaXMuY29udGFpbmVyID0gcGFyZW50RWxlbWVudDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9wdHMuaHlkcmF0ZS5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBlbGVtZW50ID0gb3B0cy5oeWRyYXRlW2ldO1xuICAgICAgICBjb25zdCBoeWRyYXRlVHlwZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKFwiZGF0YS1oeWRyYXRlXCIpO1xuICAgICAgICBpZiAoaHlkcmF0ZVR5cGUgPT09IFwiZm9udC1mYWNlXCIpIHtcbiAgICAgICAgICBoeWRyYXRlKHRoaXMuZm9udEZhY2VDYWNoZSwgRk9OVF9GQUNFX0hZRFJBVE9SLCBlbGVtZW50LnRleHRDb250ZW50KTtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaHlkcmF0ZVR5cGUgPT09IFwia2V5ZnJhbWVzXCIpIHtcbiAgICAgICAgICBoeWRyYXRlKHRoaXMua2V5ZnJhbWVzQ2FjaGUsIEtFWUZSQU1FU19IWVJEQVRPUiwgZWxlbWVudC50ZXh0Q29udGVudCk7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qga2V5ID0gZWxlbWVudC5tZWRpYSA/IGVsZW1lbnQubWVkaWEgOiBcIlwiO1xuICAgICAgICB0aGlzLnN0eWxlRWxlbWVudHNba2V5XSA9IGVsZW1lbnQ7XG4gICAgICAgIGNvbnN0IGNhY2hlID0gbmV3IENhY2hlKHN0eWxlSWRHZW5lcmF0b3IsIG9uTmV3U3R5bGUpO1xuICAgICAgICBjYWNoZS5rZXkgPSBrZXk7XG4gICAgICAgIGh5ZHJhdGVTdHlsZXMoY2FjaGUsIFNUWUxFU19IWURSQVRPUiwgZWxlbWVudC50ZXh0Q29udGVudCk7XG4gICAgICAgIHRoaXMuc3R5bGVDYWNoZS5zb3J0ZWRDYWNoZUtleXMucHVzaChrZXkpO1xuICAgICAgICB0aGlzLnN0eWxlQ2FjaGUuY2FjaGVzW2tleV0gPSBjYWNoZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIXRoaXMuY29udGFpbmVyKSB7XG4gICAgICBpZiAoZG9jdW1lbnQuaGVhZCA9PT0gbnVsbCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyBjb250YWluZXIgcHJvdmlkZWQgYW5kIGBkb2N1bWVudC5oZWFkYCB3YXMgbnVsbFwiKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQuaGVhZDtcbiAgICB9XG4gIH1cblxuICByZW5kZXJTdHlsZShzdHlsZTogU3R5bGVPYmplY3QpOiBzdHJpbmcge1xuICAgIHJldHVybiBpbmplY3RTdHlsZVByZWZpeGVkKHRoaXMuc3R5bGVDYWNoZSwgc3R5bGUsIFwiXCIsIFwiXCIpO1xuICB9XG5cbiAgcmVuZGVyRm9udEZhY2UoZm9udEZhY2U6IEZvbnRGYWNlT2JqZWN0KTogc3RyaW5nIHtcbiAgICBjb25zdCBrZXkgPSBkZWNsYXJhdGlvbnNUb0Jsb2NrKGZvbnRGYWNlKTtcbiAgICByZXR1cm4gdGhpcy5mb250RmFjZUNhY2hlLmFkZFZhbHVlKGtleSwgZm9udEZhY2UpO1xuICB9XG5cbiAgcmVuZGVyS2V5ZnJhbWVzKGtleWZyYW1lczogS2V5ZnJhbWVzT2JqZWN0KTogc3RyaW5nIHtcbiAgICBjb25zdCBrZXkgPSBrZXlmcmFtZXNUb0Jsb2NrKGtleWZyYW1lcyk7XG4gICAgcmV0dXJuIHRoaXMua2V5ZnJhbWVzQ2FjaGUuYWRkVmFsdWUoa2V5LCBrZXlmcmFtZXMpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFN0eWxldHJvbkNsaWVudDtcblxuZnVuY3Rpb24gZmluZFNoZWV0SW5kZXhXaXRoTWVkaWEoY2hpbGRyZW4sIG1lZGlhKSB7XG4gIGxldCBpbmRleCA9IDA7XG4gIGZvciAoOyBpbmRleCA8IGNoaWxkcmVuLmxlbmd0aDsgaW5kZXgrKykge1xuICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW5baW5kZXhdO1xuICAgIGlmIChcbiAgICAgIGNoaWxkLnRhZ05hbWUgPT09IFwiU1RZTEVcIiAmJlxuICAgICAgKGNoaWxkIGFzIGFueSBhcyBIVE1MU3R5bGVFbGVtZW50KS5tZWRpYSA9PT0gbWVkaWFcbiAgICApIHtcbiAgICAgIHJldHVybiBpbmRleDtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gLTE7XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUF5Q0E7O0FBU0E7O0FBRUE7O0FB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